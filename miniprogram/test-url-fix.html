<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>URLè§„èŒƒåŒ–ä¿®å¤æµ‹è¯•</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-case { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .test-title { font-weight: bold; color: #333; }
        .test-input { color: #666; margin: 5px 0; }
        .test-output { color: #008000; margin: 5px 0; }
        .test-error { color: #ff0000; }
        .test-success { color: #008000; }
    </style>
</head>
<body>
    <h1>URLè§„èŒƒåŒ–ä¿®å¤æµ‹è¯•</h1>
    <p>æµ‹è¯• normalizeUrl å‡½æ•°æ˜¯å¦èƒ½æ­£ç¡®å¤„ç†å¯¹è±¡å’Œç›¸å¯¹è·¯å¾„</p>

    <div id="test-results"></div>

    <script>
        // æ¨¡æ‹Ÿ CONFIG å¯¹è±¡
        const CONFIG = {
            base: 'https://smart-cloths-attack.loca.lt'
        };

        // å¤åˆ¶ normalizeUrl å‡½æ•°
        function normalizeUrl(u) {
            // å…è®¸ä¼ å…¥å¯¹è±¡ { url, expires } æˆ– çº¯å­—ç¬¦ä¸²
            if (u && typeof u === 'object' && u.url) {
                u = u.url;
            }
            
            // ç¡®ä¿æ˜¯å­—ç¬¦ä¸²
            if (typeof u !== 'string') {
                return '';
            }

            // ç›¸å¯¹è·¯å¾„ -> æ‹¼æˆ https ç»å¯¹åœ°å€
            if (u.startsWith('/')) {
                return `${CONFIG.base}${u}`;
            }
            
            return u;
        }

        // å¤åˆ¶ safeStringUrl å‡½æ•°
        function safeStringUrl(url) {
            const normalized = normalizeUrl(url);
            return normalized || String(url || '');
        }

        // æµ‹è¯•ç”¨ä¾‹
        const testCases = [
            {
                title: 'æµ‹è¯•1: å¯¹è±¡æ ¼å¼ {url, expires}',
                input: { url: '/files/preview/test.jpg?token=abc123', expires: '2024-01-01T00:00:00Z' },
                expected: 'https://smart-cloths-attack.loca.lt/files/preview/test.jpg?token=abc123'
            },
            {
                title: 'æµ‹è¯•2: ç›¸å¯¹è·¯å¾„å­—ç¬¦ä¸²',
                input: '/files/preview/test.jpg?token=abc123',
                expected: 'https://smart-cloths-attack.loca.lt/files/preview/test.jpg?token=abc123'
            },
            {
                title: 'æµ‹è¯•3: ç»å¯¹URLå­—ç¬¦ä¸²',
                input: 'https://example.com/image.jpg',
                expected: 'https://example.com/image.jpg'
            },
            {
                title: 'æµ‹è¯•4: null/undefined',
                input: null,
                expected: ''
            },
            {
                title: 'æµ‹è¯•5: ç©ºå¯¹è±¡',
                input: {},
                expected: ''
            },
            {
                title: 'æµ‹è¯•6: æ•°å­—ç±»å‹',
                input: 123,
                expected: ''
            },
            {
                title: 'æµ‹è¯•7: [object Object] æƒ…å†µ',
                input: { toString: () => '[object Object]' },
                expected: ''
            }
        ];

        // è¿è¡Œæµ‹è¯•
        function runTests() {
            const resultsDiv = document.getElementById('test-results');
            let allPassed = true;

            testCases.forEach((testCase, index) => {
                const result = normalizeUrl(testCase.input);
                const passed = result === testCase.expected;
                allPassed = allPassed && passed;

                const testDiv = document.createElement('div');
                testDiv.className = 'test-case';
                testDiv.innerHTML = `
                    <div class="test-title">${testCase.title}</div>
                    <div class="test-input">è¾“å…¥: ${JSON.stringify(testCase.input)}</div>
                    <div class="test-output">è¾“å‡º: ${result}</div>
                    <div class="test-output">æœŸæœ›: ${testCase.expected}</div>
                    <div class="${passed ? 'test-success' : 'test-error'}">
                        ${passed ? 'âœ… é€šè¿‡' : 'âŒ å¤±è´¥'}
                    </div>
                `;
                resultsDiv.appendChild(testDiv);
            });

            // æ·»åŠ æ€»ç»“
            const summaryDiv = document.createElement('div');
            summaryDiv.className = 'test-case';
            summaryDiv.innerHTML = `
                <div class="test-title">æµ‹è¯•æ€»ç»“</div>
                <div class="${allPassed ? 'test-success' : 'test-error'}">
                    ${allPassed ? 'ğŸ‰ æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼' : 'âš ï¸ éƒ¨åˆ†æµ‹è¯•å¤±è´¥'}
                </div>
            `;
            resultsDiv.appendChild(summaryDiv);
        }

        // é¡µé¢åŠ è½½åè¿è¡Œæµ‹è¯•
        window.onload = runTests;
    </script>
</body>
</html>